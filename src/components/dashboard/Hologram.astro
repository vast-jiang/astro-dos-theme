---

---

<!-- 
  Hologram Component
  v3.1.1 - ä¿®å¤æè´¨ä¸ºå…¨æ¯çº¿æ¡†é£æ ¼ (Wireframe + Phong + Lights)
-->
<div
  id="hologram-wrapper"
  class="relative w-full overflow-hidden group border border-dos-dim/30 bg-black/40"
  style="height: 350px; min-height: 350px;"
>
  <!-- è£…é¥°æ–‡å­— -->
  <div
    class="absolute top-2 right-2 text-[10px] text-dos-dim font-mono z-10 text-right"
  >
    <div>FOURIER_VISUALIZER</div>
    <div class="flex gap-2 justify-end">
      <span class="text-dos-primary animate-pulse">RENDERING</span>
    </div>
  </div>

  <!-- Canvas å®¹å™¨ -->
  <div id="hologram-container" class="w-full h-full relative z-0"></div>

  <!-- åº•éƒ¨è£…é¥° -->
  <div class="absolute bottom-0 left-0 w-full h-1 bg-dos-primary/20"></div>
</div>

<script>
  import * as THREE from "three";

  function initHologram() {
    console.log("ğŸš€ Hologram: Starting init (v3.1.1 Wireframe Mode)...");

    const container = document.getElementById("hologram-container");
    if (!container) {
      console.error("âŒ Hologram: Container not found!");
      return;
    }

    // æ¸…ç†æ—§åœºæ™¯ (é˜²æ­¢ View Transitions å¯¼è‡´é‡å¤ canvas)
    while (container.firstChild) {
      container.removeChild(container.firstChild);
    }

    // è·å–å°ºå¯¸
    let width = container.clientWidth || 300;
    let height = container.clientHeight || 350;

    // --- 1. åœºæ™¯ ---
    const scene = new THREE.Scene();

    // --- 2. ç›¸æœº ---
    const camera = new THREE.PerspectiveCamera(50, width / height, 0.1, 100);
    camera.position.z = 10; // ä¿æŒåŸæœ‰è·ç¦»ï¼Œé€‚åˆ Radius 2.5 çš„ç‰©ä½“

    // --- 3. æ¸²æŸ“å™¨ ---
    const renderer = new THREE.WebGLRenderer({ alpha: true, antialias: true });
    renderer.setSize(width, height);
    renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
    container.appendChild(renderer.domElement);

    // --- 4. ç¯å…‰ (æ–°å¢ï¼šä¸º Phong æè´¨æä¾›ç…§æ˜) ---
    const ambientLight = new THREE.AmbientLight(0x404040, 2); // ç¯å¢ƒå…‰
    scene.add(ambientLight);

    const pointLight = new THREE.PointLight(0xffffff, 2, 50);
    pointLight.position.set(5, 5, 5); // å…‰æºä½ç½®
    scene.add(pointLight);

    // --- 5. ç‰©ä½“ï¼šå‚…é‡Œå¶çº½ç»“ ---
    // ä¿æŒåŸæœ‰å°ºå¯¸å‚æ•°ä»¥é€‚åº”å®¹å™¨ (Radius 2.5)
    const geometry = new THREE.TorusKnotGeometry(2.5, 0.3, 150, 16, 2, 3);

    // [å…³é”®ä¿®æ”¹] æè´¨ï¼šå›å½’å…¨æ¯é£æ ¼ (Phong + Wireframe)
    const material = new THREE.MeshPhongMaterial({
      color: 0x00ff41, // æ ¸å¿ƒé¢œè‰²ï¼šç»ˆç«¯ç»¿
      emissive: 0x003300, // è‡ªå‘å…‰ï¼šæ·±ç»¿ (é˜²æ­¢æš—å¤„å®Œå…¨æ¶ˆå¤±)
      specular: 0x111111, // é«˜å…‰å¾®å¼±
      shininess: 30,
      wireframe: true, // å¼€å¯çº¿æ¡†
      transparent: true, // å¼€å¯é€æ˜
      opacity: 0.8, // 80% ä¸é€æ˜åº¦
      side: THREE.DoubleSide, // åŒé¢æ¸²æŸ“
    });

    const mesh = new THREE.Mesh(geometry, material);
    scene.add(mesh);

    // --- 6. ç²’å­ (å¢åŠ è§†è§‰ä½“ç§¯æ„Ÿï¼Œä¿æŒä¸å˜) ---
    const pGeo = new THREE.TorusKnotGeometry(2.5, 0.6, 100, 4, 2, 3);
    const pMat = new THREE.PointsMaterial({
      color: 0x33ff00, // ç²’å­ä¹Ÿæ”¹ä¸ºç»¿è‰²ï¼Œç»Ÿä¸€è‰²è°ƒ
      size: 0.03,
      transparent: true,
      opacity: 0.6,
    });
    const particles = new THREE.Points(pGeo, pMat);
    scene.add(particles);

    // --- 7. åŠ¨ç”» ---
    const animate = () => {
      // ç®€å•çš„è‡ªè½¬é€»è¾‘ï¼Œä¸ä¾èµ–å¤–éƒ¨çŠ¶æ€
      if (!renderer.domElement.parentNode) return; // é˜²æ­¢ç»„ä»¶å¸è½½åç»§ç»­è¿è¡Œ

      mesh.rotation.x += 0.005;
      mesh.rotation.y += 0.008;

      particles.rotation.x -= 0.005;
      particles.rotation.y -= 0.008;

      renderer.render(scene, camera);
      requestAnimationFrame(animate);
    };

    animate();
    console.log("âœ¨ Hologram: Animation loop started.");

    // --- Resize ---
    const onResize = () => {
      if (!container) return;
      const w = container.clientWidth;
      const h = container.clientHeight;
      camera.aspect = w / h;
      camera.updateProjectionMatrix();
      renderer.setSize(w, h);
    };
    window.addEventListener("resize", onResize);
  }

  // ç«‹å³æ‰§è¡Œ + é¡µé¢åŠ è½½åæ‰§è¡Œ (é€‚é… View Transitions)
  initHologram();
  document.addEventListener("astro:page-load", initHologram);
</script>
